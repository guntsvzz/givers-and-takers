<%# app/views/requests/_form.html.erb %>

<style>
  .form-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background: #fff;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    border-radius: 8px;
  }

  .error-box {
    background-color: #fff5f5;
    border-left: 4px solid #f56565;
    padding: 15px;
    margin-bottom: 20px;
  }

  .error-box h2 {
    color: #c53030;
    font-size: 1.1em;
    margin-bottom: 10px;
  }

  .error-box ul {
    color: #c53030;
    padding-left: 20px;
  }

  .form-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
  }

  @media (min-width: 768px) {
    .form-grid {
      grid-template-columns: 1fr 1fr;
    }
  }

  .field {
    margin-bottom: 15px;
  }

  .field label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
    color: #2d3748;
  }

  .field input[type="text"],
  .field input[type="number"],
  .field input[type="datetime-local"],
  .field textarea,
  .field select {
    width: 100%;
    padding: 8px;
    border: 1px solid #cbd5e0;
    border-radius: 4px;
    font-size: 16px;
  }

  .field textarea {
    height: 120px;
    resize: vertical;
  }

  .image-upload-container {
    border: 2px dashed #cbd5e0;
    padding: 20px;
    text-align: center;
    border-radius: 4px;
  }

  .image-preview {
    max-height: 150px;
    max-width: 100%;
    margin: 10px auto;
    display: none;
  }

  .image-preview.show {
    display: block;
  }

  .upload-button {
    background: #f7fafc;
    border: 1px solid #cbd5e0;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  }

  .upload-button:hover {
    background: #edf2f7;
  }

  .form-actions {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e2e8f0;
    text-align: right;
  }

  .submit-button {
    background: #4299e1;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
  }

  .submit-button:hover {
    background: #3182ce;
  }

  .cancel-button {
    background: #fff;
    color: #4a5568;
    padding: 10px 20px;
    border: 1px solid #cbd5e0;
    border-radius: 4px;
    margin-right: 10px;
    text-decoration: none;
    display: inline-block;
  }

  .cancel-button:hover {
    background: #f7fafc;
  }
</style>

<div class="form-container">
  <%= form_with(model: request, local: true) do |form| %>
    <% if request.errors.any? %>
      <div class="error-box">
        <h2><%= pluralize(request.errors.count, "error") %> prohibited this request from being saved:</h2>
        <ul>
          <% request.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-grid">
      <div class="form-column">
        <div class="field">
          <%= form.label :title %>
          <%= form.text_field :title %>
        </div>

        <div class="field">
          <%= form.label :description %>
          <%= form.text_area :description %>
        </div>

        <div class="field">
          <%= form.label :item_name %>
          <%= form.text_field :item_name %>
        </div>

        <div class="field">
          <%= form.label :quantity %>
          <%= form.number_field :quantity %>
        </div>
      </div>

      <div class="form-column">
        <div class="field">
          <%= form.label :start_time %>
          <%= form.datetime_local_field :start_time %>
        </div>

        <div class="field">
          <%= form.label :end_time %>
          <%= form.datetime_local_field :end_time %>
        </div>

        <div class="field">
          <%= form.label :image %>
          <div class="image-upload-container">
            <img id="image-preview" class="image-preview" />
            <%= form.file_field :image, 
                id: "image-upload",
                style: "display: none;",
                accept: 'image/*' %>
            <button type="button" class="upload-button" onclick="document.getElementById('image-upload').click()">
              Choose Image
            </button>
            <p style="font-size: 12px; color: #666; margin-top: 5px;">PNG, JPG, GIF up to 5MB</p>
          </div>
        </div>

        <% if current_user.admin? %>
          <div class="field">
            <%= form.label :status %>
            <%= form.select :status, Request.statuses.keys.map { |status| [status.humanize, status] } %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="form-actions">
      <%= link_to 'Cancel', requests_path, class: 'cancel-button' %>
      <%= form.submit class: 'submit-button' %>
    </div>
  <% end %>
</div>

<script>
  document.getElementById('image-upload')?.addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      // Check file size (5MB)
      if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB');
        this.value = '';
        return;
      }

      const reader = new FileReader();
      const preview = document.getElementById('image-preview');

      reader.onload = function(e) {
        preview.src = e.target.result;
        preview.classList.add('show');
      }

      reader.readAsDataURL(file);
    }
  });
</script>